#!/usr/bin/env bash
set -e

while getopts ":u:n:" opt; do
  case $opt in
    u)
      USERNAME=$OPTARG
      ;;
    n)
      NOTE=$OPTARG
      ;;
    \?)
      echo "Invalid option: $OPTARG" >&2
      exit 1
      ;;
    :)
      echo "Option -$OPTARG requires an argument." >&2
      exit 1
      ;;
  esac
done

if [ -z "$USERNAME" ]; then
  read -p "Github username: " USERNAME
fi

read -p "Github password: " -s PASSWORD
echo

if [ -z "$NOTE" ]; then
  NOTE="generated by ghauth"
fi

curl 'https://api.github.com/authorizations' -X POST -u $USERNAME:$PASSWORD -d "{\"scopes\":[\"repo\"],\"note\":\"$NOTE\"}"

